

#load('simulations/laart_test/12580.Rdata')
#params = simset@parameters[1,]

params = c(
    global.trate = 0.151644587532099,
    black.msm.trate.0 = 1.829550147029,
    black.msm.trate.1 = 1.97985171741938,
    black.msm.trate.2 = 1.95336680837787,
    hispanic.msm.trate.0 = 1.77863962079681,
    hispanic.msm.trate.1 = 1.22173547926565,
    hispanic.msm.trate.2 = 1.71906707347455,
    other.msm.trate.0 = 0.920028065077023,
    other.msm.trate.1 = 0.429026947399694,
    other.msm.trate.2 = 0.7260344493454,
    msm.peak.trate.multiplier = 0.290157343706876,
    black.heterosexual.trate.0 = 1.43788402722191,
    black.heterosexual.trate.1 = 1.24160360206863,
    black.heterosexual.trate.2 = 1.07555902070137,
    hispanic.heterosexual.trate.0 = 1.08751643450832,
    hispanic.heterosexual.trate.1 = 0.667812686816111,
    hispanic.heterosexual.trate.2 = 0.637525525925666,
    other.heterosexual.trate.0 = 0.292717682802851,
    other.heterosexual.trate.1 = 0.082617091731495,
    other.heterosexual.trate.2 = 0.0718045095154108,
    heterosexual.peak.trate.multiplier = 0.667186158686829,
    black.idu.trate.0 = 2.87682794332546,
    black.idu.trate.1 = 0.580832169082626,
    black.idu.trate.2 = 0.481781513001953,
    hispanic.idu.trate.0 = 1.81307829727422e-12,
    hispanic.idu.trate.1 = 1.82910599813206e-12,
    hispanic.idu.trate.2 = 8.38103477971575e-13,
    other.idu.trate.0 = 0.189982441880435,
    other.idu.trate.1 = 0.14692836656141,
    other.idu.trate.2 = 0.160054191996217,
    idu.peak.trate.multiplier = 11.4314012181891,
    msm.vs.heterosexual.male.idu.susceptibility.rr.peak = 1.57148909430576,
    msm.vs.heterosexual.male.idu.susceptibility.rr.0 = 3.47015930687532,
    msm.vs.heterosexual.male.idu.susceptibility.rr.1 = 2.82784773216659,
    msm.vs.heterosexual.male.idu.susceptibility.rr.2 = 3.31247541254673,
    age1.susceptibility.rr.mult = 1.06228980422702,
    age2.susceptibility.rr.mult = 1.18654798795581,
    age4.susceptibility.rr.mult = 0.88610866057916,
    age5.susceptibility.rr.mult = 1.14623345668056,
    age1.msm.susceptibility.rr.mult.1 = 1.42257642613,
    age2.msm.susceptibility.rr.mult.1 = 0.787085997574029,
    age4.msm.susceptibility.rr.mult.12 = 0.779351082467783,
    age5.msm.susceptibility.rr.mult.12 = 0.958512943198389,
    age1.msm.susceptibility.rr.mult.2 = 1.18921270544303,
    age2.msm.susceptibility.rr.mult.2 = 1.11753188577205,
    msm.age1.aging.base = 0.18853443445394,
    msm.age2.aging.0 = 0.139893806342002,
    msm.age2.aging.1 = 0.0775257065922992,
    msm.age3.aging.1 = 0.170729551352321,
    heterosexual.age1.aging.base = 0.226417345805844,
    heterosexual.age2.aging.0 = 0.0934989055053049,
    heterosexual.age2.aging.1 = 0.16916956494881,
    heterosexual.age3.aging.1 = 0.106874221931945,
    idu.age1.aging.base = 0.431756842838116,
    idu.age2.aging.0 = 0.198103975511319,
    idu.age2.aging.1 = 0.157793890781815,
    idu.age3.aging.1 = 0.202671389903948,
    male.vs.female.heterosexual.rr = 0.495939407541319,
    female.vs.heterosexual.male.idu.susceptibility.rr = 1.39053146682959,
    heterosexual.proportion.tested.or = 0.802391642386737,
    msm.proportion.tested.or = 0.540721350725041,
    idu.proportion.tested.or = 0.394591971055528,
    msm.idu.proportion.tested.or = 0.661804098338051,
    black.proportion.tested.or = 3.10101658848999,
    hispanic.proportion.tested.or = 1.1424780091383,
    age1.proportion.tested.or = 0.371413730132012,
    age2.proportion.tested.or = 0.64879932377808,
    age4.proportion.tested.or = 0.600182957577491,
    age5.proportion.tested.or = 0.190554110670226,
    heterosexual.proportion.tested.slope.or = 0.968068061488856,
    msm.proportion.tested.slope.or = 0.904417421290614,
    idu.proportion.tested.slope.or = 1.07317913768482,
    msm.idu.proportion.tested.slope.or = 1.01614532508512,
    testing.ramp.up.vs.current.rr = 0.654919192685757,
    heterosexual.proportion.linked.or = 1.55625247719899,
    msm.proportion.linked.or = 0.86094904202556,
    idu.proportion.linked.or = 0.229610796003688,
    msm.idu.proportion.linked.or = 0.54176394210226,
    black.proportion.linked.or = 1.34452192857257,
    hispanic.proportion.linked.or = 1.28118882797424,
    age1.proportion.linked.or = 1.13400001052456,
    age2.proportion.linked.or = 0.465856811099335,
    age4.proportion.linked.or = 0.924542965331498,
    age5.proportion.linked.or = 1.2292744357402,
    heterosexual.proportion.linked.slope.or = 1.05075850383405,
    msm.proportion.linked.slope.or = 0.983185302911935,
    idu.proportion.linked.slope.or = 0.995407518894758,
    msm.idu.proportion.linked.slope.or = 0.999289549654532,
    black.proportion.linked.slope.or = 1.00620345830486,
    hispanic.proportion.linked.slope.or = 1.00405832060036,
    age1.proportion.linked.slope.or = 0.978079680700589,
    age2.proportion.linked.slope.or = 1.1193789835608,
    age4.proportion.linked.slope.or = 0.985362387927129,
    age5.proportion.linked.slope.or = 1.02924420276415,
    heterosexual.start.art.or = 0.772656538288775,
    msm.start.art.or = 1.00583445734522,
    idu.start.art.or = 0.522096164384785,
    msm.idu.start.art.or = 0.920426208038357,
    black.start.art.or = 1.02922074845746,
    hispanic.start.art.or = 0.76073908063525,
    age1.start.art.or = 0.905445256108263,
    age2.start.art.or = 0.803290327717447,
    age4.start.art.or = 0.935277862461906,
    age5.start.art.or = 1.79400625794668,
    full.art.year = 2016.36835624114,
    heterosexual.proportion.adherent.or = 1.46738787974862,
    msm.proportion.adherent.or = 1.41703829235948,
    idu.proportion.adherent.or = 1.08449678799019,
    msm.idu.proportion.adherent.or = 0.575571412980186,
    black.proportion.adherent.or = 1.46717732855229,
    hispanic.proportion.adherent.or = 0.976289382495002,
    age1.proportion.adherent.or = 0.799921912372585,
    age2.proportion.adherent.or = 0.827887138142832,
    age4.proportion.adherent.or = 0.739947708731946,
    age5.proportion.adherent.or = 0.651973540623086,
    heterosexual.proportion.adherent.slope.or = 1.17720841887075,
    msm.proportion.adherent.slope.or = 1.07188902726531,
    idu.proportion.adherent.slope.or = 0.989772745104148,
    msm.idu.proportion.adherent.slope.or = 1.07613045704487,
    black.proportion.adherent.slope.or = 1.026777081816,
    hispanic.proportion.adherent.slope.or = 1.00787007669682,
    age1.proportion.adherent.slope.or = 0.998093327386869,
    age2.proportion.adherent.slope.or = 1.01939389420085,
    age4.proportion.adherent.slope.or = 1.00732677741406,
    age5.proportion.adherent.slope.or = 0.944906934952715,
    recently.suppressed.vs.failing.proportion.adherent.or = 0.98145411975404,
    durably.suppressed.vs.failing.proportion.adherent.or = 1.01358225080335,
    naive.vs.failing.proportion.adherent.or = 0.529057429570532,
    heterosexual.proportion.lost.or = 2.27157167971112,
    msm.proportion.lost.or = 2.25119933364943,
    idu.proportion.lost.or = 1.64451954996256,
    msm.idu.proportion.lost.or = 2.28849755510931,
    black.proportion.lost.or = 1.1032395046434,
    hispanic.proportion.lost.or = 1.48263164228958,
    age1.proportion.lost.or = 1.00840490120937,
    age2.proportion.lost.or = 0.971804393041302,
    age4.proportion.lost.or = 1.07994213696241,
    age5.proportion.lost.or = 2.12936908066563,
    heterosexual.proportion.lost.slope.or = 0.978999878224906,
    msm.proportion.lost.slope.or = 0.999624584357014,
    idu.proportion.lost.slope.or = 0.903478733825847,
    msm.idu.proportion.lost.slope.or = 1.001166459596,
    black.proportion.lost.slope.or = 0.89056299536158,
    hispanic.proportion.lost.slope.or = 0.920398893288031,
    age1.proportion.lost.or = 1.00840490120937,
    age2.proportion.lost.or = 0.971804393041302,
    age4.proportion.lost.or = 1.07994213696241,
    age5.proportion.lost.or = 2.12936908066563,
    heterosexual.proportion.lost.slope.or = 0.978999878224906,
    msm.proportion.lost.slope.or = 0.999624584357014,
    idu.proportion.lost.slope.or = 0.903478733825847,
    msm.idu.proportion.lost.slope.or = 1.001166459596,
    black.proportion.lost.slope.or = 0.89056299536158,
    hispanic.proportion.lost.slope.or = 0.920398893288031,
    age1.proportion.lost.slope.or = 0.945078416735249,
    age2.proportion.lost.slope.or = 1.00512361819779,
    age4.proportion.lost.slope.or = 0.973197448720779,
    age5.proportion.lost.slope.or = 1.02089164180661,
    recently.suppressed.vs.failing.proportion.lost.or = 0.908637389069467,
    durably.suppressed.vs.failing.proportion.lost.or = 1.01632288468496,
    naive.vs.failing.proportion.lost.or = 0.864150617668388,
    already.lost.vs.failing.proportion.lost.or = 0.282601242292017,
    msm.prep.intercept.or = 0.444384264471887,
    non.msm.prep.intercept.or = 0.651104547132152,
    msm.prep.slope.or = 1.5549393975136,
    idu.prep.slope.or = 0.234906267818898,
    heterosexual.prep.slope.or = 0.115605083006899,
    black.prep.or = 0.937385768610907,
    hispanic.prep.or = 0.780829401130501,
    age1.prep.or = 1.64026490836036,
    age2.prep.or = 1.33723222875391,
    age4.prep.or = 0.606719498861674,
    age5.prep.or = 0.674280666047444,
    prep.efficacy.z = 0.300814375042892,
    prep.persistence = 0.438626512002837,
    proportion.msm.of.male.mult = 0.872927016426626,
    black.incident.idu.multiplier.0 = 5.13704485256922,
    hispanic.incident.idu.multiplier.0 = 2.69071134979545,
    other.incident.idu.multiplier.0 = 1.02295491576151,
    black.incident.idu.multiplier.2 = 1.121399931152,
    hispanic.incident.idu.multiplier.2 = 0.422179869879125,
    other.incident.idu.multiplier.2 = 1.14049537018446,
    msm.incident.idu.multiplier.0 = 0.959564182260732,
    msm.incident.idu.multiplier.2 = 0.911191195321987,
    idu.remission.multiplier = 1.30715568552778,
    idu.relapse.multiplier = 0.939059846106857,
    hiv.mortality.0 = 0.115928009369892,
    hiv.mortality.2 = 0.0189269800766837,
    peak.hiv.mortality = 0.146158017406188,
    age.mixing.sd.mult = 1.19404124045249,
    oe.female.pairings.with.msm = 0.0667302595640647,
    fraction.heterosexual.male.pairings.with.male = 0.00184462848575168,
    oe.never.idu.pairings.with.idu = 0.199182060839562,
    black.black.sexual.oe = 2.88049490601591,
    hispanic.hispanic.sexual.oe = 2.04808652703912,
    other.other.sexual.oe = 2.38492104148786,
    acute.transmissibility.rr = 16.8349404537487,
    diagnosed.transmission.rr = 0.288457969466623,
    msm.fraction.trate.change.after.t2 = 0.028754627855796,
    heterosexual.fraction.trate.change.after.t2 = 0.0228008664381161,
    idu.fraction.trate.change.after.t2 = 0.042208998598773
)

source('code/source_code.R')

source('code/settings_and_files/setup_versions.R')
source('code/applications/depression/depression_jheem_settings.R')
source('code/applications/depression/depression_parameters.R')

params = c(params,
           get.medians(DEPRESSION.PARAMETERS.PRIOR))

run.simulation = create.run.simulation.function('12580', params,
                                                version='depression_1.0')


sim = run.simulation(params)

source('code/processing/visualization/sim_plots.R')
simplot(sim)

round(extract.new.diagnoses(sim, keep.dimensions = c('year','subpopulation'), per.population = NA))
do.extract.population.subset(sim, keep.dimensions = c('year','subpopulation')) / do.extract.population.subset(sim)

print("ALL DONE!")

if (1==2)
{
    source('code/applications/depression/depression_best_rate_estimates.R')
    source('code/applications/depression/read_depression_into_comorbidities.R')
    comorbidities.manager = create.comorbidities.manager()
    comorbidities.manager = read.depression.data.into.comorbidities.manager(comorbidities.manager)
    ALL.DATA.MANAGERS$comorbidities = comorbidities.manager
}

